<!DOCTYPE html>
<html>
  <head>
    <title>Geolocation</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Bevan&display=swap" rel="stylesheet">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
       .ice-cream-list-pic{
         object-fit: cover;
         width: 100%;
         height: 250px;;
       }
       .ice-cream-list {
        border-style: solid;
        overflow-x: auto;
       }

       .ice-cream-list h2{
        font-family: 'Bevan';
       }
      #panel { 
        background-color: white;
        position:absolute;
        top:0;
        left:0;
        bottom:0;
        /* width:300px; */
        width: 33%;
        overflow-y: auto;
        border-style: solid;
      }
      #map {
        position:absolute;
        top:0;
        /* left:300px; */
        left:33%;
        right:0;
        bottom:0;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="panel">
      
    </div>
    <div id="map"></div>
    <script>
      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      var map, infoWindow;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 41.8781, lng: -87.6298},
          zoom: 10,
					styles: [
            {
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#242f3e"
                }
              ]
            },
            {
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#746855"
                }
              ]
            },
            {
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#242f3e"
                }
              ]
            },
            {
              "featureType": "administrative.land_parcel",
              "elementType": "labels",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "administrative.locality",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#d59563"
                }
              ]
            },
            {
              "featureType": "poi",
              "elementType": "labels.text",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "poi",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#d59563"
                }
              ]
            },
            {
              "featureType": "poi.business",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "poi.park",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#263c3f"
                }
              ]
            },
            {
              "featureType": "poi.park",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#6b9a76"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#38414e"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "geometry.stroke",
              "stylers": [
                {
                  "color": "#212a37"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "labels.icon",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#9ca5b3"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#746855"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "geometry.stroke",
              "stylers": [
                {
                  "color": "#1f2835"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#f3d19c"
                }
              ]
            },
            {
              "featureType": "road.local",
              "elementType": "labels",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "transit",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "transit",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#2f3948"
                }
              ]
            },
            {
              "featureType": "transit.station",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#d59563"
                }
              ]
            },
            {
              "featureType": "water",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#17263c"
                }
              ]
            },
            {
              "featureType": "water",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#515c6d"
                }
              ]
            },
            {
              "featureType": "water",
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#17263c"
                }
              ]
            }
          ]
        });
				infoWindow = new google.maps.InfoWindow;
				


        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
						};
            var curPos = new google.maps.LatLng(pos.lat, pos.lng);

            var request = {
              location: curPos,
              radius: '200',
              query: "ice cream"
						};
						
						function createMarkers(places) {
              console.log(places[0]);
							var bounds = new google.maps.LatLngBounds();
							var placesList = document.getElementById('places');
              let place;
              var infoWindowContent;

							for (var i = 0; i < 10; i++) {
                place = places[i]

                var request = {
                  placeId: place.place_id,
                  fields: ['website', 'formatted_phone_number', 'rating', 'name', 'url', 'photos', 'formatted_address', 'geometry']
                }

                service = new google.maps.places.PlacesService(map);
                service.getDetails(request, function (place, status){
                  if (status == google.maps.places.PlacesServiceStatus.OK){
                    console.log(curPos)
                    console.log(place.geometry.location)
                    var panel = document.getElementById('panel');

                    var div = document.createElement('div');
                    var imgDiv = document.createElement('div');
                    var h2 = document.createElement('h2')
                    var p = document.createElement('p');
                    var aWebsite = document.createElement('a');
                    var aUrl = document.createElement('a');
                    var img = document.createElement('img');
                    var br = document.createElement('br');

                    img.className = "ice-cream-list-pic"
                    img.src = place.photos[2].getUrl();
                    img.width = "200";
                    img.height = "200";
                    imgDiv.append(img);

                    aUrl.href = place.url;
                    aUrl.target = "_blank";
                    aUrl.textContent = "Directions"

                    aWebsite.href = place.website;
                    aWebsite.target = "_blank"
                    aWebsite.textContent = "Website"
                    div.className = "ice-cream-list";
                    p.textContent = place.formatted_address
                    h2.textContent = `${place.name}`;
                    div.append(h2, imgDiv, aUrl, br, aWebsite, p);
                    panel.appendChild(div);
                  }
                  else{
                    console.log(status);
                  }
                })

								var image = {
									url: "https://www.cfacdn.com/img/order/COM/Menu_Refresh/Drinks/Drinks%20PDP/_0000s_0027_%5BFeed%5D_0006s_0013_Drinks_Ice-Dream.png",
									size: new google.maps.Size(100, 100),
									origin: new google.maps.Point(0, 0),
									anchor: new google.maps.Point(17, 34),
									scaledSize: new google.maps.Size(50, 50)
								};

                infoWindowContent = '<div class="info_content">' +
									`<h3>${place.name}</h3>` + `<p>${place.formatted_address}</p>` + 
									'</div>';

								var marker = new google.maps.Marker({
									map: map,
									icon: image,
									title: place.name,
                  position: place.geometry.location,
									label: {
                    text: `${i + 1}`,
                    color: 'white'
                    },
									clickable: true
								});
                
								marker.info = new google.maps.InfoWindow({
                  content: infoWindowContent
                });
                
                console.log(marker)
                
                google.maps.event.addListener(marker, 'click', function() {
                  console.log(marker);
                  var thisMap = this.getMap()
									this.info.open(this.getMap(), this);
                });

                bounds.extend(place.geometry.location);
              }
              map.fitBounds(bounds);
            }
            




            service = new google.maps.places.PlacesService(map);
            service.textSearch(request, callback);

            function callback(results, status) {
              var myLatLng = {};
              if (status == google.maps.places.PlacesServiceStatus.OK) {
                createMarkers(results);
              }
            }
            
						
            infoWindow.setPosition(pos);
						infoWindow.setContent('You are here!!!!!!');
            infoWindow.open(map);


            
						// marker.setMap(map)
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3kAVv71tq2luKRlNpWEclUl_6qrbwo2Q&callback=initMap&libraries=places">
    </script>
  </body>
</html>